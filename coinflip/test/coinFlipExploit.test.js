const { ethers } = require('hardhat')
const { expect } = require('chai')

async function deployContracts() {
    const coinFlipFactory = await ethers.getContractFactory('CoinFlip')
    const coinFlip = await coinFlipFactory.deploy()

    const coinFlipExploitFactory = await ethers.getContractFactory('CoinFlipExploit')
    const coinFlipExploit = await coinFlipExploitFactory.deploy()

    return { coinFlip, coinFlipExploit }
}

describe('CoinFlipExplit should', function() {
    it('gues 10 times in a row', async function () {
        const { coinFlip, coinFlipExploit } = await deployContracts()

        const coinFlipAddress = coinFlip.address
        for (let i = 0; i < 10; i++) {
            await coinFlipExploit.win(coinFlipAddress)
        }
        expect(await coinFlip.consecutiveWins()).eq(10)
    })
})